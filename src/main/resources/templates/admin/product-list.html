<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒí’ˆ ê´€ë¦¬ - ê´€ë¦¬ì</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-container">
            <a href="/" class="logo">ğŸ›ï¸ Mini Shopping Mall - ê´€ë¦¬ì</a>
            <nav class="nav-links">
                <div class="dropdown" id="categoryDropdown">
                    <a href="#" class="dropdown-toggle" onclick="toggleDropdown(event)">ìƒí’ˆ â–¼</a>
                    <div class="dropdown-menu">
                        <a href="/products">ì „ì²´ ìƒí’ˆ</a>
                        <a th:each="category : ${categories}" 
                           th:href="@{/products(category=${category})}" 
                           th:text="${category}"></a>
                    </div>
                </div>
                <a href="/admin/products">ìƒí’ˆ ê´€ë¦¬</a>
                <a href="/admin/coupons">ì¿ í° ê´€ë¦¬</a>
                <a href="/admin/orders">ì£¼ë¬¸ ê´€ë¦¬</a>
                <form th:action="@{/logout}" method="post" style="display: inline;">
                    <button type="submit" class="btn-logout">ë¡œê·¸ì•„ì›ƒ</button>
                </form>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <h2 style="margin: 40px 0 20px 0;">ìƒí’ˆ ê´€ë¦¬</h2>
        
        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0;">
            <div>
                <a href="/admin/products/new" class="btn-primary">+ ìƒˆ ìƒí’ˆ ë“±ë¡</a>
            </div>
            <div>
                <form action="/admin/products" method="get" id="searchForm" style="display: inline-flex; gap: 10px;">
                    <input type="text" name="search" id="searchInput" th:value="${search}" 
                           placeholder="ìƒí’ˆëª… ê²€ìƒ‰... (ìë™ê²€ìƒ‰)" 
                           oninput="autoSearch()"
                           style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px; width: 300px;">
                    <a href="/admin/products" th:if="${search != null}" class="btn-primary" style="margin: 0; background: #888; text-decoration: none; display: inline-block; padding: 10px 20px;">âœ• ì´ˆê¸°í™”</a>
                </form>
            </div>
        </div>
        
        <div style="margin: 10px 0; color: #666;">
            <p>ì „ì²´ <strong th:text="${totalItems}"></strong>ê°œ ìƒí’ˆ 
               (í˜ì´ì§€ <strong th:text="${currentPage + 1}"></strong> / <strong th:text="${totalPages}"></strong>)
            </p>
        </div>
        
        <div class="admin-table">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ìƒí’ˆëª…</th>
                        <th>ê°€ê²©</th>
                        <th>ì¬ê³ </th>
                        <th>ì¹´í…Œê³ ë¦¬</th>
                        <th>ìƒíƒœ</th>
                        <th>ë“±ë¡ì¼</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="product : ${products}">
                        <td th:text="${product.id}"></td>
                        <td th:text="${product.name}"></td>
                        <td th:text="|${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')}ì›|"></td>
                        <td th:text="${product.stock}"></td>
                        <td th:text="${product.category}"></td>
                        <td>
                            <span th:if="${product.available}" style="color: green;">íŒë§¤ì¤‘</span>
                            <span th:unless="${product.available}" style="color: red;">íŒë§¤ì¤‘ì§€</span>
                        </td>
                        <td th:text="${#temporals.format(product.createdAt, 'yyyy-MM-dd')}"></td>
                        <td>
                            <a th:href="@{/admin/products/{id}/edit(id=${product.id}, page=${currentPage}, size=${pageSize})}" 
                               class="btn-small btn-edit">ìˆ˜ì •</a>
                            <form th:action="@{/admin/products/{id}/delete(id=${product.id}, page=${currentPage}, size=${pageSize})}" 
                                  method="post" style="display: inline;" 
                                  onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                <button type="submit" class="btn-small btn-delete">ì‚­ì œ</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div th:if="${products.isEmpty()}" style="text-align: center; padding: 40px; color: #777;">
            <p th:if="${search != null}">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            <p th:if="${search == null}">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        
        <!-- Pagination -->
        <div th:if="${!products.isEmpty()}" style="margin: 30px 0; text-align: center;">
            <div class="pagination" th:if="${totalPages > 1}">
                <!-- ì²˜ìŒ í˜ì´ì§€ -->
                <a th:href="@{/admin/products(page=0, size=${pageSize}, search=${search})}" 
                   th:classappend="${currentPage == 0} ? 'disabled' : ''"
                   class="page-link">ì²˜ìŒ</a>
                
                <!-- ì´ì „ í˜ì´ì§€ -->
                <a th:href="@{/admin/products(page=${currentPage - 1}, size=${pageSize}, search=${search})}" 
                   th:classappend="${currentPage == 0} ? 'disabled' : ''"
                   class="page-link">ì´ì „</a>
                
                <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
                <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                    <a th:if="${i >= currentPage - 2 and i <= currentPage + 2}"
                       th:href="@{/admin/products(page=${i}, size=${pageSize}, search=${search})}" 
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="page-link"></a>
                </th:block>
                
                <!-- ë‹¤ìŒ í˜ì´ì§€ -->
                <a th:href="@{/admin/products(page=${currentPage + 1}, size=${pageSize}, search=${search})}" 
                   th:classappend="${currentPage == totalPages - 1} ? 'disabled' : ''"
                   class="page-link">ë‹¤ìŒ</a>
                
                <!-- ë§ˆì§€ë§‰ í˜ì´ì§€ -->
                <a th:href="@{/admin/products(page=${totalPages - 1}, size=${pageSize}, search=${search})}" 
                   th:classappend="${currentPage == totalPages - 1} ? 'disabled' : ''"
                   class="page-link">ë§ˆì§€ë§‰</a>
            </div>
            
            <!-- í˜ì´ì§€ í¬ê¸° ì„ íƒ (í•­ìƒ í‘œì‹œ) -->
            <div style="margin-top: 15px;">
                <label style="margin-right: 10px; font-weight: 500;">í˜ì´ì§€ë‹¹ í•­ëª©:</label>
                <select onchange="changePageSize(this.value)" style="padding: 8px 15px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem; cursor: pointer;">
                    <option value="5" th:selected="${pageSize == 5}">5ê°œ</option>
                    <option value="10" th:selected="${pageSize == 10}">10ê°œ</option>
                    <option value="20" th:selected="${pageSize == 20}">20ê°œ</option>
                    <option value="50" th:selected="${pageSize == 50}">50ê°œ</option>
                </select>
            </div>
        </div>
    </div>
    
    <script>
        let searchTimeout;
        
        // ìë™ ê²€ìƒ‰ (500ms í›„ ì‹¤í–‰)
        function autoSearch() {
            clearTimeout(searchTimeout);
            
            searchTimeout = setTimeout(() => {
                const form = document.getElementById('searchForm');
                const searchInput = document.getElementById('searchInput');
                
                // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì „ì²´ ëª©ë¡ìœ¼ë¡œ
                if (searchInput.value.trim() === '') {
                    window.location.href = '/admin/products';
                } else {
                    form.submit();
                }
            }, 500);
        }
        
        function changePageSize(size) {
            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set('size', size);
            urlParams.set('page', '0');
            window.location.href = '/admin/products?' + urlParams.toString();
        }
    </script>
</body>
</html>

