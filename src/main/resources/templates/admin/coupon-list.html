<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¿ í° ê´€ë¦¬ - ê´€ë¦¬ì</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-container">
            <a href="/" class="logo">ğŸ›ï¸ Mini Shopping Mall - ê´€ë¦¬ì</a>
            <nav class="nav-links">
                <a href="/admin/products">ìƒí’ˆ ê´€ë¦¬</a>
                <a href="/admin/coupons">ì¿ í° ê´€ë¦¬</a>
                <form th:action="@{/logout}" method="post" style="display: inline;">
                    <button type="submit" class="btn-logout">ë¡œê·¸ì•„ì›ƒ</button>
                </form>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container" style="max-width: 1400px;">
        <h2 style="margin: 40px 0 20px 0;">ì¿ í° ê´€ë¦¬</h2>
        
        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
        
        <div style="margin: 20px 0;">
            <a href="/admin/coupons/new" class="btn-primary">+ ìƒˆ ì¿ í° ìƒì„±</a>
        </div>
        
        <div class="admin-table">
            <table style="white-space: nowrap;">
                <thead>
                    <tr>
                        <th style="white-space: nowrap;">ID</th>
                        <th style="white-space: nowrap;">ì¿ í° ì½”ë“œ</th>
                        <th style="white-space: nowrap;">ì¿ í°ëª…</th>
                        <th style="white-space: nowrap;">í• ì¸</th>
                        <th style="white-space: nowrap;">ìµœì†Œ êµ¬ë§¤ê¸ˆì•¡</th>
                        <th style="white-space: nowrap;">ì‚¬ìš© ì œí•œ</th>
                        <th style="white-space: nowrap;">ì‚¬ìš© íšŸìˆ˜</th>
                        <th style="white-space: nowrap;">ìœ íš¨ê¸°ê°„</th>
                        <th style="white-space: nowrap;">ìƒíƒœ</th>
                        <th style="white-space: nowrap;">ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="coupon : ${coupons}">
                        <td style="white-space: nowrap;" th:text="${coupon.id}"></td>
                        <td style="white-space: nowrap;"><strong th:text="${coupon.code}"></strong></td>
                        <td style="white-space: nowrap;" th:text="${coupon.name}"></td>
                        <td style="white-space: nowrap;">
                            <span th:if="${coupon.discountType.toString() == 'PERCENTAGE'}">
                                <span th:text="${coupon.discountValue}"></span>%
                            </span>
                            <span th:if="${coupon.discountType.toString() == 'FIXED'}">
                                <span th:text="${#numbers.formatDecimal(coupon.discountValue, 0, 'COMMA', 0, 'POINT')}"></span>ì›
                            </span>
                        </td>
                        <td style="white-space: nowrap;" th:text="${#numbers.formatDecimal(coupon.minPurchaseAmount, 0, 'COMMA', 0, 'POINT')} + 'ì›'"></td>
                        <td style="white-space: nowrap;">
                            <span th:if="${coupon.usageLimit == null}">ë¬´ì œí•œ</span>
                            <span th:if="${coupon.usageLimit != null}" th:text="${coupon.usageLimit} + 'íšŒ'"></span>
                        </td>
                        <td style="white-space: nowrap;" th:text="${coupon.usedCount} + '/' + (${coupon.usageLimit == null} ? 'âˆ' : ${coupon.usageLimit})"></td>
                        <td style="white-space: nowrap;">
                            <small th:text="${#temporals.format(coupon.validFrom, 'yyyy-MM-dd')} + ' ~ ' + ${#temporals.format(coupon.validTo, 'yyyy-MM-dd')}"></small>
                        </td>
                        <td style="white-space: nowrap;">
                            <span th:if="${coupon.active}" style="color: green;">í™œì„±</span>
                            <span th:unless="${coupon.active}" style="color: red;">ë¹„í™œì„±</span>
                        </td>
                        <td style="white-space: nowrap;">
                            <a th:href="@{/admin/coupons/{id}/edit(id=${coupon.id})}" 
                               class="btn-small btn-edit">ìˆ˜ì •</a>
                            <form th:action="@{/admin/coupons/{id}/delete(id=${coupon.id})}" 
                                  method="post" style="display: inline;" 
                                  onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                <button type="submit" class="btn-small btn-delete">ì‚­ì œ</button>
                            </form>
                            <div style="margin-top: 5px;">
                                <a th:href="@{/admin/coupons/{id}/issue(id=${coupon.id})}" 
                                   class="btn-small" style="font-size: 0.85rem; background: #667eea; text-decoration: none; display: inline-block;">
                                    íšŒì› ì„ íƒ ì§€ê¸‰
                                </a>
                                <form th:action="@{/admin/coupons/{couponId}/issue(couponId=${coupon.id})}" 
                                      method="post" style="display: inline;" 
                                      onsubmit="return confirm('ëª¨ë“  íšŒì›ì—ê²Œ ì¿ í°ì„ ì§€ê¸‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                    <input type="hidden" name="issueToAll" value="true">
                                    <button type="submit" class="btn-small" 
                                            style="font-size: 0.85rem; background: #27ae60;">ì „ì²´ì§€ê¸‰</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div th:if="${coupons.isEmpty()}" style="text-align: center; padding: 40px; color: #777;">
            <p>ë“±ë¡ëœ ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>
    <style>
        .admin-table {
            width: 100%;
            overflow-x: auto;
        }
        .admin-table table {
            white-space: nowrap;
            width: 100%;
            min-width: 1200px;
        }
        .admin-table th,
        .admin-table td {
            white-space: nowrap;
            padding: 15px 20px;
        }
    </style>
    <script src="/js/dropdown.js"></script>
</body>
</html>

