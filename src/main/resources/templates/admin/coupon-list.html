<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쿠폰 관리 - 관리자</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-container">
            <a href="/" class="logo">🛍️ Mini Shopping Mall - 관리자</a>
            <nav class="nav-links">
                <a href="/admin/products">상품 관리</a>
                <a href="/admin/coupons">쿠폰 관리</a>
                <form th:action="@{/logout}" method="post" style="display: inline;">
                    <button type="submit" class="btn-logout">로그아웃</button>
                </form>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container" style="max-width: 1400px;">
        <h2 style="margin: 40px 0 20px 0;">쿠폰 관리</h2>
        
        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
        
        <div style="margin: 20px 0;">
            <a href="/admin/coupons/new" class="btn-primary">+ 새 쿠폰 생성</a>
        </div>
        
        <div class="admin-table">
            <table style="white-space: nowrap;">
                <thead>
                    <tr>
                        <th style="white-space: nowrap;">ID</th>
                        <th style="white-space: nowrap;">쿠폰 코드</th>
                        <th style="white-space: nowrap;">쿠폰명</th>
                        <th style="white-space: nowrap;">할인</th>
                        <th style="white-space: nowrap;">최소 구매금액</th>
                        <th style="white-space: nowrap;">사용 제한</th>
                        <th style="white-space: nowrap;">사용 횟수</th>
                        <th style="white-space: nowrap;">유효기간</th>
                        <th style="white-space: nowrap;">상태</th>
                        <th style="white-space: nowrap;">관리</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="coupon : ${coupons}">
                        <td style="white-space: nowrap;" th:text="${coupon.id}"></td>
                        <td style="white-space: nowrap;"><strong th:text="${coupon.code}"></strong></td>
                        <td style="white-space: nowrap;" th:text="${coupon.name}"></td>
                        <td style="white-space: nowrap;">
                            <span th:if="${coupon.discountType.toString() == 'PERCENTAGE'}">
                                <span th:text="${coupon.discountValue}"></span>%
                            </span>
                            <span th:if="${coupon.discountType.toString() == 'FIXED'}">
                                <span th:text="${#numbers.formatDecimal(coupon.discountValue, 0, 'COMMA', 0, 'POINT')}"></span>원
                            </span>
                        </td>
                        <td style="white-space: nowrap;" th:text="${#numbers.formatDecimal(coupon.minPurchaseAmount, 0, 'COMMA', 0, 'POINT')} + '원'"></td>
                        <td style="white-space: nowrap;">
                            <span th:if="${coupon.usageLimit == null}">무제한</span>
                            <span th:if="${coupon.usageLimit != null}" th:text="${coupon.usageLimit} + '회'"></span>
                        </td>
                        <td style="white-space: nowrap;" th:text="${coupon.usedCount} + '/' + (${coupon.usageLimit == null} ? '∞' : ${coupon.usageLimit})"></td>
                        <td style="white-space: nowrap;">
                            <small th:text="${#temporals.format(coupon.validFrom, 'yyyy-MM-dd')} + ' ~ ' + ${#temporals.format(coupon.validTo, 'yyyy-MM-dd')}"></small>
                        </td>
                        <td style="white-space: nowrap;">
                            <span th:if="${coupon.active}" style="color: green;">활성</span>
                            <span th:unless="${coupon.active}" style="color: red;">비활성</span>
                        </td>
                        <td style="white-space: nowrap;">
                            <a th:href="@{/admin/coupons/{id}/edit(id=${coupon.id})}" 
                               class="btn-small btn-edit">수정</a>
                            <form th:action="@{/admin/coupons/{id}/delete(id=${coupon.id})}" 
                                  method="post" style="display: inline;" 
                                  onsubmit="return confirm('정말 삭제하시겠습니까?');">
                                <button type="submit" class="btn-small btn-delete">삭제</button>
                            </form>
                            <div style="margin-top: 5px;">
                                <a th:href="@{/admin/coupons/{id}/issue(id=${coupon.id})}" 
                                   class="btn-small" style="font-size: 0.85rem; background: #667eea; text-decoration: none; display: inline-block;">
                                    회원 선택 지급
                                </a>
                                <form th:action="@{/admin/coupons/{couponId}/issue(couponId=${coupon.id})}" 
                                      method="post" style="display: inline;" 
                                      onsubmit="return confirm('모든 회원에게 쿠폰을 지급하시겠습니까?');">
                                    <input type="hidden" name="issueToAll" value="true">
                                    <button type="submit" class="btn-small" 
                                            style="font-size: 0.85rem; background: #27ae60;">전체지급</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div th:if="${coupons.isEmpty()}" style="text-align: center; padding: 40px; color: #777;">
            <p>등록된 쿠폰이 없습니다.</p>
        </div>
    </div>
    <style>
        .admin-table {
            width: 100%;
            overflow-x: auto;
        }
        .admin-table table {
            white-space: nowrap;
            width: 100%;
            min-width: 1200px;
        }
        .admin-table th,
        .admin-table td {
            white-space: nowrap;
            padding: 15px 20px;
        }
    </style>
    <script src="/js/dropdown.js"></script>
</body>
</html>

