<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${isEdit ? '상품 수정' : '상품 등록'} + ' - 관리자'"></title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-container">
            <a href="/" class="logo">🛍️ Mini Shopping Mall - 관리자</a>
            <nav class="nav-links">
                <div class="dropdown" id="categoryDropdown">
                    <a href="#" class="dropdown-toggle" onclick="toggleDropdown(event)">상품 ▼</a>
                    <div class="dropdown-menu">
                        <a href="/products">전체 상품</a>
                        <a th:each="category : ${categories}" 
                           th:href="@{/products(category=${category})}" 
                           th:text="${category}"></a>
                    </div>
                </div>
                <a href="/admin/products">상품 관리</a>
                <a href="/admin/coupons">쿠폰 관리</a>
                <form th:action="@{/logout}" method="post" style="display: inline;">
                    <button type="submit" class="btn-logout">로그아웃</button>
                </form>
            </nav>
        </div>
    </header>

    <!-- Product Form -->
    <div class="auth-container" style="max-width: 600px;">
        <h2 th:text="${isEdit ? '상품 수정' : '상품 등록'}"></h2>
        
        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
        
        <form th:action="${isEdit ? '/admin/products/' + product.id : '/admin/products'}" 
              th:object="${product}" method="post" enctype="multipart/form-data">
            
            <!-- 페이지 정보 유지 -->
            <input type="hidden" name="page" th:value="${page != null ? page : 0}" />
            <input type="hidden" name="size" th:value="${size != null ? size : 10}" />
            
            <div class="form-group">
                <label for="name">상품명 *</label>
                <input type="text" id="name" th:field="*{name}" required>
                <div class="error" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
            </div>
            
            <div class="form-group">
                <label for="description">상품 설명</label>
                <textarea id="description" th:field="*{description}" rows="5" 
                          style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 5px; font-family: inherit;"></textarea>
                <div class="error" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
            </div>
            
            <div class="form-group">
                <label for="price">가격 (원) *</label>
                <input type="number" id="price" th:field="*{price}" step="0.01" required>
                <div class="error" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></div>
            </div>
            
            <div class="form-group">
                <label for="stock">재고 수량 *</label>
                <input type="number" id="stock" th:field="*{stock}" required>
                <div class="error" th:if="${#fields.hasErrors('stock')}" th:errors="*{stock}"></div>
            </div>
            
            <div class="form-group">
                <label for="category">카테고리</label>
                <select id="category" th:field="*{category}" 
                        style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 5px;">
                    <option value="전자제품">전자제품</option>
                    <option value="가구">가구</option>
                    <option value="의류">의류</option>
                    <option value="도서">도서</option>
                    <option value="식품">식품</option>
                    <option value="기타">기타</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="imageFile">상품 이미지</label>
                <input type="file" id="imageFile" name="imageFile" accept="image/*"
                       style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 5px;">
                <small style="display: block; margin-top: 5px; color: #666;">
                    이미지 파일을 업로드하세요 (JPG, PNG, GIF, WEBP 형식, 최대 10MB)
                </small>
                <div th:if="${product.imageUrl != null && !product.imageUrl.isEmpty()}" style="margin-top: 10px;">
                    <p style="margin: 5px 0; color: #666;">현재 이미지:</p>
                    <img th:src="@{${product.imageUrl}}" 
                         alt="현재 상품 이미지" 
                         style="max-width: 200px; max-height: 200px; border: 1px solid #ddd; border-radius: 5px; margin-top: 5px;">
                    <p style="margin: 5px 0; color: #666; font-size: 0.9em;" th:text="'경로: ' + ${product.imageUrl}"></p>
                </div>
                <div class="error" th:if="${#fields.hasErrors('imageUrl')}" th:errors="*{imageUrl}"></div>
            </div>
            
            <div class="form-group">
                <label for="imageUrl">이미지 URL (직접 입력)</label>
                <input type="text" id="imageUrl" th:field="*{imageUrl}" 
                       placeholder="https://example.com/image.jpg 또는 이미지 파일을 업로드하세요">
                <small style="display: block; margin-top: 5px; color: #666;">
                    이미지 파일을 업로드하거나 URL을 직접 입력할 수 있습니다. 파일 업로드를 우선합니다.
                </small>
                <div class="error" th:if="${#fields.hasErrors('imageUrl')}" th:errors="*{imageUrl}"></div>
            </div>
            
            <div class="form-group">
                <label for="available">판매 상태</label>
                <div style="display: flex; align-items: center; padding: 12px 0;">
                    <input type="checkbox" id="available" th:field="*{available}" 
                           style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;">
                    <label for="available" style="margin: 0; cursor: pointer; font-weight: normal;">판매 가능</label>
                </div>
            </div>
            
            <button type="submit" class="btn-submit" th:text="${isEdit ? '수정하기' : '등록하기'}"></button>
        </form>
        
        <div class="form-footer">
            <a th:href="@{/admin/products(page=${page != null ? page : 0}, size=${size != null ? size : 10})}">
                목록으로 돌아가기
            </a>
        </div>
    </div>
    <script src="/js/dropdown.js"></script>
</body>
</html>

